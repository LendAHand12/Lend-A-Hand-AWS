import{b as R,W as B,c as O}from"./web3-core-1459409c.js";import{a as G,F as W,D as m,B as tt}from"./web3-types-ce0eb23a.js";import{a5 as b,a6 as et,d as I,S as N}from"./web3-errors-484f11ce.js";import"./web3-eth-iban-921c5698.js";import"./is-my-json-valid-2c93b9e3.js";import{i as P,t as st,v as F,W as it}from"./web3-validator-6b520267.js";import"./events-f5832a60.js";import"./setimmediate-338d4348.js";import{b as k,l as nt,g as ot,c as rt,a as at,s as $,e as ct,N as H}from"./web3-eth-621954e4.js";import{e as q,k as T,c as D,h as dt,d as ut,l as lt,b as Y,g as ht,i as ft,m as vt,n as mt,j as M}from"./web3-eth-abi-08eb3436.js";import{i as C,f as A,m as x,t as K,w as gt,H as y}from"./web3-utils-f506bce1.js";const bt="ALLEVENTS",U={name:bt,signature:"",type:"event",inputs:[]},V=({address:u},t,e)=>{var s,i;const r=e==null?void 0:e.topics,a=(s=e==null?void 0:e.filter)!==null&&s!==void 0?s:{},o={};if(C(e==null?void 0:e.fromBlock)||(o.fromBlock=A(k.properties.number,e==null?void 0:e.fromBlock,{number:G.HEX,bytes:W.HEX})),C(e==null?void 0:e.toBlock)||(o.toBlock=A(k.properties.number,e==null?void 0:e.toBlock,{number:G.HEX,bytes:W.HEX})),r&&Array.isArray(r))o.topics=[...r];else if(o.topics=[],t&&!t.anonymous&&t.name!=="ALLEVENTS"&&o.topics.push((i=t.signature)!==null&&i!==void 0?i:q(T(t))),t.name!=="ALLEVENTS"&&t.inputs)for(const c of t.inputs){if(!c.indexed)continue;const n=a[c.name];if(!n){o.topics.push(null);continue}Array.isArray(n)?o.topics.push(n.map(l=>D(c.type,l))):o.topics.push(D(c.type,n))}return o.topics.length||delete o.topics,u&&(o.address=u.toLowerCase()),o},z=(u,t,e,s=m)=>{var i,r,a,o,c;let n=Object.assign({},u);const l=A(nt,t,s);if(n.name==="ALLEVENTS"){const d=e.find(h=>h.signature===t.topics[0]);d?n=d:n={anonymous:!0}}if(n.inputs=(r=(i=n.inputs)!==null&&i!==void 0?i:u.inputs)!==null&&r!==void 0?r:[],!n.anonymous){let d=0;((a=n.inputs)!==null&&a!==void 0?a:[]).forEach(h=>{h.indexed&&(d+=1)}),d>0&&(t!=null&&t.topics)&&(t==null?void 0:t.topics.length)!==d+1&&(n=Object.assign(Object.assign({},n),{anonymous:!0,inputs:[]}))}const f=n.anonymous?t.topics:((o=t.topics)!==null&&o!==void 0?o:[]).slice(1);return Object.assign(Object.assign({},l),{returnValues:dt([...(c=n.inputs)!==null&&c!==void 0?c:[]],t.data,f),event:n.name,signature:n.anonymous||!t.topics||t.topics.length===0||!t.topics[0]?void 0:t.topics[0],raw:{data:t.data,topics:t.topics}})},E=(u,t,e)=>{const s=Array.isArray(u.inputs)?u.inputs.length:0;if(s!==t.length)throw new b(`The number of arguments is not matching the methods required number. You need to pass ${s} arguments.`);const i=ut(Array.isArray(u.inputs)?u.inputs:[],t).replace("0x","");if(lt(u)){if(!e)throw new b("The contract has no contract data option set. This is necessary to append the constructor parameters.");return e.startsWith("0x")?`${e}${i}`:`0x${e}${i}`}return`${Y(u)}${i}`},pt=(u,t)=>{if(u.type==="constructor")return t;if(!t)return null;const e=t.length>=2?t.slice(2):t;if(!u.outputs)return null;const s=ht([...u.outputs],e);return s.__length__===1?s[0]:s};class Q extends R{constructor(t,e){super(t,e),this.address=t.address,this.topics=t.topics,this.abi=t.abi,this.jsonInterface=t.jsonInterface}_buildSubscriptionParams(){return["logs",{address:this.address,topics:this.topics}]}_processSubscriptionResult(t){const e=z(this.abi,t,this.jsonInterface,super.returnFormat);this.emit("data",e)}}const J=({abi:u,params:t,options:e,contractOptions:s})=>{var i,r;if(!((r=(i=e==null?void 0:e.input)!==null&&i!==void 0?i:e==null?void 0:e.data)!==null&&r!==void 0?r:s.input)&&!(e!=null&&e.to)&&!s.address)throw new b("Contract address not specified");if(!(e!=null&&e.from)&&!s.from)throw new b('Contract "from" address not specified');let o=x({to:s.address,gas:s.gas,gasPrice:s.gasPrice,from:s.from,input:s.input,maxPriorityFeePerGas:s.maxPriorityFeePerGas,maxFeePerGas:s.maxFeePerGas},e);return(!o.input||u.type==="constructor")&&(o=Object.assign(Object.assign({},o),{input:E(u,t,o.input)})),o},_t=({abi:u,params:t,options:e,contractOptions:s})=>{if(!(e!=null&&e.to)&&!s.address)throw new b("Contract address not specified");let i=x({to:s.address,gas:s.gas,gasPrice:s.gasPrice,from:s.from,input:s.input,maxPriorityFeePerGas:s.maxPriorityFeePerGas,maxFeePerGas:s.maxFeePerGas},e);return i=Object.assign(Object.assign({},i),{input:E(u,t,i.input?K(i.input):void 0)}),i},yt=({abi:u,params:t,options:e,contractOptions:s})=>{let i=x({to:s.address,gas:s.gas,gasPrice:s.gasPrice,from:s.from,input:s.input},e);return i=Object.assign(Object.assign({},i),{input:E(u,t,i.input?K(i.input):void 0)}),i},L=u=>typeof u=="object"&&!C(u)&&["input","data","from","gas","gasPrice","gasLimit","address","jsonInterface","syncWithContext"].some(t=>t in u),X=u=>typeof u=="object"&&!C(u)&&!L(u),At=({abi:u,params:t,options:e,contractOptions:s})=>{if(!(e!=null&&e.to)&&!s.address)throw new b("Contract address not specified");if(!(e!=null&&e.from)&&!s.from)throw new b('Contract "from" address not specified');let i=x({to:s.address,gas:s.gas,gasPrice:s.gasPrice,from:s.from,input:s.input,maxPriorityFeePerGas:s.maxPriorityFeePerGas,maxFeePerGas:s.maxFeePerGas},e);return(!i.input||u.type==="constructor")&&(i=Object.assign(Object.assign({},i),{input:E(u,t,i.input)})),i};var _=globalThis&&globalThis.__awaiter||function(u,t,e,s){function i(r){return r instanceof e?r:new e(function(a){a(r)})}return new(e||(e=Promise))(function(r,a){function o(l){try{n(s.next(l))}catch(f){a(f)}}function c(l){try{n(s.throw(l))}catch(f){a(f)}}function n(l){l.done?r(l.value):i(l.value).then(o,c)}n((s=s.apply(u,t||[])).next())})};const Et={logs:Q,newHeads:H,newBlockHeaders:H};class S extends B{constructor(t,e,s,i,r){var a,o,c;const n=L(e)?e:L(s)?s:void 0;if(!P(n)&&!P(n.data)&&!P(n.input))throw new et({data:n.data,input:n.input});let l;X(e)?l=e:X(s)?l=s:l=i;let f;typeof e=="object"&&"provider"in e?f=e.provider:typeof s=="object"&&"provider"in s?f=s.provider:typeof i=="object"&&"provider"in i?f=i.provider:f=S.givenProvider,super(Object.assign(Object.assign({},l),{provider:f,registeredSubscriptions:Et})),this.syncWithContext=!1,this._functions={},this._overloadedMethodAbis=new Map;const d=y(i)?i:y(s)?s:r??m,h=typeof e=="string"?e:void 0;this._parseAndSetJsonInterface(t,d),P(h)||this._parseAndSetAddress(h,d),this.options={address:h,jsonInterface:this._jsonInterface,gas:(a=n==null?void 0:n.gas)!==null&&a!==void 0?a:n==null?void 0:n.gasLimit,gasPrice:n==null?void 0:n.gasPrice,from:n==null?void 0:n.from,input:(o=n==null?void 0:n.input)!==null&&o!==void 0?o:n==null?void 0:n.data},this.syncWithContext=(c=n==null?void 0:n.syncWithContext)!==null&&c!==void 0?c:!1,l instanceof B&&this.subscribeToContextEvents(l),Object.defineProperty(this.options,"address",{set:v=>this._parseAndSetAddress(v,d),get:()=>this._address}),Object.defineProperty(this.options,"jsonInterface",{set:v=>this._parseAndSetJsonInterface(v,d),get:()=>this._jsonInterface})}get events(){return this._events}get methods(){return this._methods}clone(){let t;return this.options.address?t=new S([...this._jsonInterface,...this._errorsInterface],this.options.address,{gas:this.options.gas,gasPrice:this.options.gasPrice,from:this.options.from,input:this.options.input,provider:this.currentProvider,syncWithContext:this.syncWithContext},this.getContextObject()):t=new S([...this._jsonInterface,...this._errorsInterface],{gas:this.options.gas,gasPrice:this.options.gasPrice,from:this.options.from,input:this.options.input,provider:this.currentProvider,syncWithContext:this.syncWithContext},this.getContextObject()),this.context&&t.subscribeToContextEvents(this.context),t}deploy(t){var e,s,i;let r=this._jsonInterface.find(n=>n.type==="constructor");r||(r={type:"constructor",inputs:[],stateMutability:""});const a=A({format:"bytes"},(s=(e=t==null?void 0:t.input)!==null&&e!==void 0?e:t==null?void 0:t.data)!==null&&s!==void 0?s:this.options.input,m);if(!a||a.trim()==="0x")throw new b("contract creation without any data provided.");const o=(i=t==null?void 0:t.arguments)!==null&&i!==void 0?i:[],c=Object.assign(Object.assign({},this.options),{input:a});return{arguments:o,send:n=>{const l=Object.assign({},n);return this._contractMethodDeploySend(r,o,l,c)},estimateGas:(n,l=m)=>_(this,void 0,void 0,function*(){const f=Object.assign({},n);return this._contractMethodEstimateGas({abi:r,params:o,returnFormat:l,options:f,contractOptions:c})}),encodeABI:()=>E(r,o,A({format:"bytes"},a,m))}}getPastEvents(t,e,s){var i;return _(this,void 0,void 0,function*(){const r=typeof t=="string"?t:"allEvents",a=typeof t!="string"&&!y(t)?t:y(e)?{}:e,o=y(t)?t:y(e)?e:s??m,c=r==="allEvents"?U:this._jsonInterface.find(p=>"name"in p&&p.name===r);if(!c)throw new b(`Event ${r} not found.`);const{fromBlock:n,toBlock:l,topics:f,address:d}=V(this.options,c,a??{}),v=(yield ot(this,{fromBlock:n,toBlock:l,topics:f,address:d},o)).map(p=>typeof p=="string"?p:z(c,p,this._jsonInterface,o)),g=(i=a==null?void 0:a.filter)!==null&&i!==void 0?i:{},w=Object.keys(g);return r==="allEvents"&&w.length>0?v.filter(p=>typeof p=="string"?!0:w.every(j=>Array.isArray(g[j])?g[j].some(Z=>String(p.returnValues[j]).toUpperCase()===String(Z).toUpperCase()):String(p.returnValues[j]).toUpperCase()===String(g[j]).toUpperCase())):v})}_parseAndSetAddress(t,e=m){this._address=t&&gt(A({format:"address"},t,e))}_parseAndSetJsonInterface(t,e=m){var s,i,r,a,o;this._functions={},this._methods={},this._events={};let c=[];const n=t.filter(f=>f.type!=="error"),l=t.filter(f=>ft(f));for(const f of n){const d=Object.assign(Object.assign({},f),{signature:""});if(vt(d)){const h=T(d),v=Y(h);d.signature=v,d.constant=(i=(s=d.stateMutability==="view")!==null&&s!==void 0?s:d.stateMutability==="pure")!==null&&i!==void 0?i:d.constant,d.payable=(r=d.stateMutability==="payable")!==null&&r!==void 0?r:d.payable,this._overloadedMethodAbis.set(d.name,[...(a=this._overloadedMethodAbis.get(d.name))!==null&&a!==void 0?a:[],d]);const g=(o=this._overloadedMethodAbis.get(d.name))!==null&&o!==void 0?o:[],w=this._createContractMethod(g,l);this._functions[h]={signature:v,method:w},this._methods[d.name]=this._functions[h].method,this._methods[h]=this._functions[h].method,this._methods[v]=this._functions[h].method}else if(mt(d)){const h=T(d),v=q(h),g=this._createContractEvent(d,e);d.signature=v,(!(h in this._events)||d.name==="bound")&&(this._events[h]=g),this._events[d.name]=g,this._events[v]=g}this._events.allEvents=this._createContractEvent(U,e),c=[...c,d]}this._jsonInterface=[...c],this._errorsInterface=l}_getAbiParams(t,e){var s;try{return st((s=t.inputs)!==null&&s!==void 0?s:[],e)}catch(i){throw new b(`Invalid parameters for method ${t.name}: ${i.message}`)}}_createContractMethod(t,e){const s=t[t.length-1];return(...i)=>{var r,a;let o;const c=(r=this._overloadedMethodAbis.get(s.name))!==null&&r!==void 0?r:[];let n=c[0];const l=e,f=c.filter(h=>{var v;return((v=h.inputs)!==null&&v!==void 0?v:[]).length===i.length});if(c.length===1||f.length===0)o=this._getAbiParams(n,i),F.validate((a=s.inputs)!==null&&a!==void 0?a:[],o);else{const h=[];for(const v of f)try{o=this._getAbiParams(v,i),F.validate(v.inputs,o),n=v;break}catch(g){h.push(g)}if(h.length===f.length)throw new it(h)}const d={arguments:o,call:(h,v)=>_(this,void 0,void 0,function*(){return this._contractMethodCall(n,o,l,h,v)}),send:h=>this._contractMethodSend(n,o,l,h),estimateGas:(h,v=m)=>_(this,void 0,void 0,function*(){return this._contractMethodEstimateGas({abi:n,params:o,returnFormat:v,options:h})}),encodeABI:()=>E(n,o),createAccessList:(h,v)=>_(this,void 0,void 0,function*(){return this._contractMethodCreateAccessList(n,o,l,h,v)})};return n.stateMutability==="payable",d}}_contractMethodCall(t,e,s,i,r){var a;return _(this,void 0,void 0,function*(){const o=_t({abi:t,params:e,options:i,contractOptions:Object.assign(Object.assign({},this.options),{from:(a=this.options.from)!==null&&a!==void 0?a:this.config.defaultAccount})});try{const c=yield rt(this,o,r,m);return pt(t,c)}catch(c){throw c instanceof I&&M(s,c.innerError),c}})}_contractMethodCreateAccessList(t,e,s,i,r){var a;return _(this,void 0,void 0,function*(){const o=At({abi:t,params:e,options:i,contractOptions:Object.assign(Object.assign({},this.options),{from:(a=this.options.from)!==null&&a!==void 0?a:this.config.defaultAccount})});try{return at(this,o,r,m)}catch(c){throw c instanceof I&&M(s,c.innerError),c}})}_contractMethodSend(t,e,s,i,r){var a,o;let c=r??this.options;c=Object.assign(Object.assign({},c),{input:void 0,from:(o=(a=c.from)!==null&&a!==void 0?a:this.defaultAccount)!==null&&o!==void 0?o:void 0});const n=J({abi:t,params:e,options:i,contractOptions:c}),l=$(this,n,m,{checkRevertBeforeSending:!1});return l.on("error",f=>{f instanceof I&&M(s,f.innerError)}),l}_contractMethodDeploySend(t,e,s,i){var r,a;let o=i??this.options;o=Object.assign(Object.assign({},o),{from:(a=(r=o.from)!==null&&r!==void 0?r:this.defaultAccount)!==null&&a!==void 0?a:void 0});const c=J({abi:t,params:e,options:s,contractOptions:o});return $(this,c,m,{transactionResolver:n=>{if(n.status===BigInt(0))throw new b("code couldn't be stored",n);const l=this.clone();return l.options.address=n.contractAddress,l},checkRevertBeforeSending:!1})}_contractMethodEstimateGas({abi:t,params:e,returnFormat:s,options:i,contractOptions:r}){return _(this,void 0,void 0,function*(){const a=yt({abi:t,params:e,options:i,contractOptions:r??this.options});return ct(this,a,tt.LATEST,s)})}_createContractEvent(t,e=m){return(...s)=>{var i;const{topics:r,fromBlock:a}=V(this.options,t,s[0]),o=new Q({address:this.options.address,topics:r,abi:t,jsonInterface:this._jsonInterface},{requestManager:this.requestManager,returnFormat:e});return P(a)||this.getPastEvents(t.name,{fromBlock:a,topics:r},e).then(c=>{c.forEach(n=>o.emit("data",n))}).catch(()=>{o.emit("error",new N("Failed to get past events."))}),(i=this.subscriptionManager)===null||i===void 0||i.addSubscription(o).catch(()=>{o.emit("error",new N("Failed to subscribe."))}),o}}subscribeToContextEvents(t){const e=this;this.context=t,e.syncWithContext&&t.on(O.CONFIG_CHANGE,s=>{e.setConfig({[s.name]:s.newValue})})}}export{S as C};
